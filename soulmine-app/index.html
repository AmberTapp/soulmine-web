<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SoulMine ‚Äî Web3 –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å $LOVE</title>
  <link rel="stylesheet" href="./styles/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://unpkg.com/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash-screen" class="splash-screen">
    <div class="splash-content">
      <div class="splash-logo">üíú</div>
      <h1 class="splash-title">SoulMine</h1>
      <p class="splash-subtitle">–í—Å–µ–ª–µ–Ω–Ω–∞—è –õ—é–±–≤–∏ –Ω–∞ TON</p>
      <p class="splash-desc">–ì–¥–µ AI –Ω–∞—Ö–æ–¥–∏—Ç —Ç–≤–æ—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –∞ –∫–∞–∂–¥—ã–π –∑–≤–æ–Ω–æ–∫ = $LOVE</p>
      <div class="splash-loader">
        <div class="loader-heart">üíú</div>
        <div class="loader-heart">üíú</div>
        <div class="loader-heart">üíú</div>
      </div>
    </div>
  </div>

  <!-- AI Advice Popup -->
  <div id="ai-advice">
    <div id="ai-message">–û—Ç–ª–∏—á–Ω–∞—è —Ö–∏–º–∏—è! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ üëè</div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Movement Banner (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ) -->
    <div class="movement-banner" style="display: none;">
      <p>üíú –¢—ã ‚Äî —á–∞—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è <strong>#LoveOnTON</strong></p>
      <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ 1,000,000+ –∞–ø–æ—Å—Ç–æ–ª–æ–≤ –ª—é–±–≤–∏</p>
    </div>

    <!-- Main Screen -->
    <div id="main-screen" class="screen active">
      <div class="hero-section">
        <h1 class="app-logo">SoulMine</h1>
        <p class="app-slogan">Web3 –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å –º–∞–π–Ω–∏–Ω–≥–æ–º $LOVE</p>
        <p class="app-desc">AI –Ω–∞—Ö–æ–¥–∏—Ç —Ç–≤–æ—é –∏–¥–µ–∞–ª—å–Ω—É—é –ø–∞—Ä—É. –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ = –∫—Ä–∏–ø—Ç–∞.</p>
        <div class="zero-friction-slogan">
          üíû –ù—É–ª–µ–≤–æ–µ —Ç—Ä–µ–Ω–∏–µ: –ø–æ–¥–∫–ª—é—á–∏–ª –∫–æ—à–µ–ª–µ–∫ ‚Äî –ø–æ–ª—É—á–∏–ª $LOVE
        </div>
      </div>

      <button id="ton-connect-button" class="btn btn-primary" style="width: 100%; margin-bottom: 20px;">
        üîê –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON Wallet
      </button>

      <div id="wallet-info" style="display: none; background: rgba(0,0,0,0.3); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
        <strong>–ê–¥—Ä–µ—Å:</strong> <span id="wallet-address-display">...</span>
      </div>

      <div style="display: flex; gap: 10px; margin: 20px 0;">
        <button onclick="showScreen('quests')" class="btn btn-secondary" style="flex: 1;">üèÜ –ö–≤–µ—Å—Ç—ã</button>
        <button onclick="showScreen('history')" class="btn btn-secondary" style="flex: 1;">üìû –ò—Å—Ç–æ—Ä–∏—è</button>
      </div>

      <button onclick="findRandomPartner()" class="btn btn-primary" style="width: 100%; margin: 20px 0;">
        üíò –ù–∞–π—Ç–∏ —Å–ª—É—á–∞–π–Ω—É—é –ø–∞—Ä—É
      </button>

      <button onclick="showScreen('swipe-screen')" class="btn btn-secondary" style="width: 100%; margin: 10px 0;">
        üëâ –°–≤–∞–π–ø–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏
      </button>

      <div class="resource-links">
        <a href="https://t.me/LoveSoulMine_Bot" target="_blank">ü§ñ Telegram Bot</a>
        <a href="https://github.com/AmberTapp/soulmine-web" target="_blank">üíª GitHub</a>
      </div>
    </div>

    <!-- Swipe Screen -->
    <div id="swipe-screen" class="screen">
      <div class="header">
        <h1>–°–≤–∞–π–ø–∞–π—Ç–µ ‚ù§Ô∏è</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ—é –∏–¥–µ–∞–ª—å–Ω—É—é –ø–∞—Ä—É</p>
      </div>
      <div id="swipe-area" class="swipe-area"></div>
      <div class="action-buttons-fixed">
        <button onclick="openChatWithCurrent()" class="action-btn chat-btn" title="–ß–∞—Ç">üí¨</button>
        <button onclick="startVoiceCallWithCurrent()" class="action-btn call-btn" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫">üìû</button>
        <button onclick="startVideoCallWithCurrent()" class="action-btn video-btn" title="–í–∏–¥–µ–æ –∑–≤–æ–Ω–æ–∫">üé•</button>
      </div>
    </div>

    <!-- Profile Screen -->
    <div id="profile" class="screen">
      <div class="header">
        <h1>–í–∞—à –ü—Ä–æ—Ñ–∏–ª—å</h1>
      </div>
      <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 16px; margin-bottom: 20px;">
        <h3>–ë–∞–ª–∞–Ω—Å: <span id="profile-balance-profile">–ó–∞–≥—Ä—É–∑–∫–∞...</span></h3>
        <div id="user-stats" style="margin-top: 16px;"></div>
      </div>
      <h3>–í–∞—à–∏ NFT</h3>
      <div id="nft-container-profile" style="margin: 20px 0;"></div>
      <h3>–ü–∞—Ä–Ω—ã–µ NFT</h3>
      <div id="couple-nft-section" style="display: none;">
        <div id="couple-nft-container-profile"></div>
      </div>
      <button onclick="showScreen('main-screen')" class="btn btn-secondary" style="width: 100%; margin-top: 20px;">
        –ù–∞–∑–∞–¥
      </button>
    </div>

    <!-- Quests Screen -->
    <div id="quests" class="screen">
      <div class="header">
        <h1>–ö–≤–µ—Å—Ç—ã</h1>
        <p>–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è ‚Äî –ø–æ–ª—É—á–∞–π—Ç–µ $LOVE –∏ NFT</p>
      </div>
      <div id="quests-list"></div>
      <button onclick="checkAllQuests()" class="btn btn-secondary" style="width: 100%; margin-top: 20px;">
        üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–≤–µ—Å—Ç—ã
      </button>
    </div>

    <!-- Call History Screen -->
    <div id="history" class="screen">
      <div class="header">
        <h1>–ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤</h1>
      </div>
      <div id="call-history-list"></div>
    </div>

    <!-- DAO Screen -->
    <div id="dao" class="screen">
      <div class="header">
        <h1>DAO –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h1>
        <p>–£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ SoulMine</p>
      </div>
      <div class="citizen-nft-display" id="citizen-nft-display">
        <div style="color: #aaa;">–ó–∞–≥—Ä—É–∑–∫–∞ NFT...</div>
      </div>
      <div id="proposals-list"></div>
    </div>

    <!-- Contacts Screen -->
    <div id="contacts" class="screen">
      <div class="header">
        <h1>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ –¥—Ä—É–∑–µ–π –≤ SoulMine</p>
      </div>
      <button onclick="loadTelegramContacts()" class="btn btn-primary" style="width: 100%; margin-bottom: 20px;">
        üì± –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã Telegram
      </button>
      <div id="contacts-list"></div>
    </div>

    <!-- NFT Modal -->
    <div id="nft-modal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal()">√ó</button>
        <h2 style="text-align: center; margin-bottom: 20px;">üéâ –ü–æ–ª—É—á–µ–Ω–æ NFT!</h2>
        <h3 id="nft-name" style="text-align: center; margin-bottom: 30px;">"–ù–∞–∑–≤–∞–Ω–∏–µ NFT"</h3>
        <button onclick="closeModal()" class="btn btn-primary" style="width: 100%;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
    </div>

    <!-- AI Params Modal -->
    <div id="ai-params-modal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="document.getElementById('ai-params-modal').style.display='none'">√ó</button>
        <h2 style="text-align: center; margin-bottom: 20px;">AI SoulMatch</h2>
        <div style="margin-bottom: 20px;">
          <label>–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω:</label>
          <select id="age-range" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 8px; background: #1a1a2e; color: white; border: 1px solid #00d1b2;">
            <option value="18-25">18-25</option>
            <option value="26-35">26-35</option>
            <option value="36-45">36-45</option>
            <option value="45+">45+</option>
          </select>
        </div>
        <div style="margin-bottom: 20px;">
          <label>–¶–µ–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞:</label>
          <select id="goal" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 8px; background: #1a1a2e; color: white; border: 1px solid #00d1b2;">
            <option value="dating">–°–µ—Ä—å–µ–∑–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è</option>
            <option value="friendship">–î—Ä—É–∂–±–∞</option>
            <option value="networking">Web3-–Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥</option>
          </select>
        </div>
        <div style="margin-bottom: 20px;">
          <label>–ò–Ω—Ç–µ—Ä–µ—Å—ã (–≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ 3):</label>
          <div id="interests-container" class="interests-container"></div>
        </div>
        <button onclick="saveAIParams()" class="btn btn-primary" style="width: 100%;">–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫</button>
      </div>
    </div>

    <!-- Searching Modal -->
    <div id="searching-modal" class="modal">
      <div class="modal-content" style="text-align: center;">
        <h2>–ò—â–µ–º –¥–ª—è –≤–∞—Å –∏–¥–µ–∞–ª—å–Ω—É—é –ø–∞—Ä—É...</h2>
        <p style="margin: 20px 0; color: #aaa;">AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</p>
        <div style="width: 50px; height: 50px; border: 4px solid #00d1b2; border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        <button onclick="cancelSearch()" class="btn btn-secondary" style="margin-top: 20px;">–û—Ç–º–µ–Ω–∏—Ç—å</button>
      </div>
    </div>

    <!-- Video Call Modal -->
    <div id="video-modal" class="modal">
      <div style="position: relative; width: 100%; max-width: 400px;">
        <div id="ar-effects"></div>
        <video id="local-video" autoplay playsinline></video>
        <video id="remote-video" autoplay playsinline style="margin-top: 16px;"></video>
        <div id="video-status" style="color: #aaa; text-align: center; margin: 10px 0;">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
        <div id="video-timer" style="font-size: 24px; font-weight: bold; text-align: center; margin: 10px 0;">00:00</div>
        <div style="display: flex; gap: 10px; margin: 20px 0;">
          <button class="filter-btn" onclick="applyFilter('none')">–û–±—ã—á–Ω—ã–π</button>
          <button class="filter-btn" onclick="applyFilter('hearts')">‚ù§Ô∏è</button>
          <button class="filter-btn" onclick="applyFilter('ton')">üíé</button>
          <button class="filter-btn" onclick="applyFilter('party')">üéâ</button>
        </div>
        <div style="display: flex; gap: 10px;">
          <button onclick="captureMoment()" class="btn btn-secondary" style="flex: 1;">üì∏ –°–Ω–∏–º–æ–∫</button>
          <button onclick="endVideoCall()" class="btn btn-primary" style="flex: 1;">‚ùå –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav">
    <button class="nav-btn active" onclick="showScreen('main-screen')">
      <div class="nav-icon">üè†</div>
      <div>–ì–ª–∞–≤–Ω–∞—è</div>
    </button>
    <button class="nav-btn" onclick="showScreen('swipe-screen')">
      <div class="nav-icon">‚ù§Ô∏è</div>
      <div>–°–≤–∞–π–ø—ã</div>
    </button>
    <button class="nav-btn" onclick="showScreen('profile')">
      <div class="nav-icon">üë§</div>
      <div>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </button>
    <button class="nav-btn" onclick="showScreen('quests')">
      <div class="nav-icon">üèÜ</div>
      <div>–ö–≤–µ—Å—Ç—ã</div>
    </button>
    <button class="nav-btn" onclick="showScreen('dao')">
      <div class="nav-icon">üèõÔ∏è</div>
      <div>DAO</div>
    </button>
  </div>

  <!-- Scripts -->
<script src="./scripts/utils.js" defer></script>
<script src="./scripts/ton.js" defer></script>
<script src="./scripts/main.js" defer></script>
<script src="./scripts/video-call.js" defer></script>
<script src="./scripts/dao.js" defer></script>
<script src="./scripts/contacts.js" defer></script>

  <script>
    // –î–ª—è –æ—Ç–º–µ–Ω—ã –ø–æ–∏—Å–∫–∞
    function cancelSearch() {
      if (window.isSearching && window.ws && window.ws.readyState === WebSocket.OPEN) {
        window.ws.send(JSON.stringify({ type: 'cancel_search' }));
        window.isSearching = false;
      }
      document.getElementById('searching-modal').style.display = 'none';
    }
  </script>
</body>

</html>
